<div *ngIf="lstview; else elseBlock1">
  <div class="card-header">
    <h2>Danh sách biên bản LKDT/BTP</h2>
    <form name="form" (ngSubmit)="f.form.valid && refreshExamination()" #f="ngForm" novalidate>
      <div class="row">
        <div class="col-md-3" style="width: 12.5%;">
          <div class="form-group">
            <label>Từ ngày</label>
            <input type="date" class="form-control" name="startDate" [(ngModel)]="formSearch.startDate" #name="ngModel"
              placeholder="Từ ngày" />
          </div>
        </div>
        <div class="col-md-3" style="width: 12.5%;">
          <div class="form-group">
            <label>Tới ngày</label>
            <input type="date" class="form-control" name="endDate" [(ngModel)]="formSearch.endDate" #name="ngModel"
              placeholder="Tới ngày" />
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label>Tên biên bản</label>
            <input type="text" class="form-control" name="name" [(ngModel)]="formSearch.name" #name="ngModel"
              placeholder="Tên biên bản" />
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group">
            <label>Mã biên bản</label>
            <input type="text" class="form-control" name="code" [(ngModel)]="formSearch.code" #name="ngModel"
              placeholder="Mã biên bản" />
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group">
            <label>Số biên bản</label>
            <input type="text" class="form-control" name="reportCode" [(ngModel)]="formSearch.reportCode"
              #name="ngModel" placeholder="Số biên bản" />
          </div>
        </div>

      </div>
      <div class="row">

        <div class="col-md-3">
          <div class="form-group">
            <label>Số hóa đơn</label>
            <input type="text" class="form-control" name="invoiceNumber" [(ngModel)]="formSearch.invoiceNumber"
              #name="ngModel" placeholder="Số hóa đơn" />
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group">
            <label>Trạng thái</label>
            <select class="form-control" name="type" [(ngModel)]="formSearch.status" #type="ngModel"
              style="height: 40px;">
              <option selected value="">Tất cả</option>
              <option selected value="DRAFF">Nháp</option>
              <option value="WAIT_APPROVE">Chờ duyệt</option>
              <option value="APPROVE">Đã duyệt</option>
              <option value="CONCESSIONS">Nhân nhượng</option>
              <option value="REJECT">Từ chối</option>
              <option value="CANCEL">Hủy</option>
            </select>
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group">
            <label>Loại hàng</label>
            <select class="form-control" name="itemType" [(ngModel)]="formSearch.itemType" #type="ngModel"
              style="height: 40px;">
              <option value="">Tất cả</option>
              <option value="Hàng nhập">Hàng nhập</option>
              <option value="Hàng mẫu">Hàng mẫu</option>
            </select>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label>Nhà cung cấp</label>
            <input type="text" class="form-control" [(ngModel)]="selectedOrigin" value={{formSearch.origin}}
              name="origin" [matAutocomplete]="originS" [formControl]="searchOriginCtrl" placeholder="Nhà cung cấp"
              style="height: 40px;">
            <mat-autocomplete #originS="matAutocomplete" (optionSelected)="onSelectedOriginS()"
              [displayWith]="displayWith">
              <mat-option *ngIf="isLoadingOrigin" class="is-loading">Loading...</mat-option>
              <ng-container *ngIf="!isLoadingOrigin">
                <mat-option value="">
                  <span>Tất cả</span>
                </mat-option>
                <mat-option *ngFor="let oitm of filteredOrigin.lstOcrd" [value]="oitm">
                  <span><b>{{oitm.name}}</b> ({{oitm.code}})</span>
                </mat-option>
              </ng-container>
            </mat-autocomplete>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-3">
          <div class="form-group">
            <button class="btn btn-primary m-2" type="submit" style="height:40px">
              <i class="fa fa-search"></i> Tìm kiếm
            </button>

            <!-- <button class="btn btn-success" routerLink="/iqc/iqc-lkdt-check/0/add"> -->
            <button class="btn btn-success" (click)="createReport()">
              <i class="fa fa-plus"></i> Thêm biên bản
            </button>

          </div>
        </div>
      </div>
    </form>


  </div>
  <div class="card-body">
    <div class="table-responsive">
      <nz-table #basicTable nzBordered [nzPageSize]="10" nzShowSizeChanger [nzFrontPagination]="false"
        [nzData]="auditnvl" [nzTotal]="collectionSize" [(nzPageIndex)]="page" [(nzPageSize)]="pageSize"
        (nzPageIndexChange)="refreshExamination()" (nzPageSizeChange)="refreshExamination()">
        <thead>
          <tr class="table-header">
            <th scope="col">#</th>
            <th scope="col" style="width: 10.2%;">Số biên bản</th>
            <th scope="col" style="width: 11%;">Mã biên bản</th>
            <th scope="col" style="width: 11%;">Tên biên bản</th>
            <th scope="col" style="width: 11%;">Nhà cung cấp</th>
            <th scope="col">Loại</th>
            <th scope="col">Ngày nhận hàng</th>
            <th scope="col">Ngày thực hiện</th>
            <th scope="col">Ngày cập nhật</th>
            <th scope="col">Trạng thái</th>
            <th scope="col">Người tạo</th>
            <th style="width: 13%;">Nhận xét</th>
            <th scope="col">Tùy chọn</th>
          </tr>
        </thead>
        <tbody class="table-row">
          <tr *ngFor="let audit of auditnvl;let i = index;">
            <td>{{ i+1 }}</td>
            <td>{{ audit.reportCode}}</td>
            <td>{{ audit.elecCompCode}}</td>
            <td>{{ audit.electCompName }}</td>
            <td>{{ audit.origin }}</td>
            <td> <span *ngIf="audit.iqcElectType == 'false'">IQC</span><span *ngIf="audit.iqcElectType == 'true'">Phiếu
                SPKPH</span> </td>
            <td> {{ audit.importDate | date:'dd/MM/yyyy'}}</td>
            <td> {{ audit.createdAt | date:'dd/MM/yyyy HH:mm:ss'}}</td>
            <td>{{ audit.updatedAt | date:'dd/MM/yyyy HH:mm:ss'}}</td>
            <td>
              <p *ngIf="audit.status =='DRAFF'"> Nháp</p>
              <p *ngIf="audit.status =='WAIT_APPROVE'"> Chờ duyệt </p>
              <p *ngIf="audit.status =='APPROVE'"> Đã duyệt </p>
              <p *ngIf="audit.status =='REJECT'"> Từ chối </p>
              <p *ngIf="audit.status =='CONCESSIONS'"> Nhân nhượng </p>
              <p *ngIf="audit.status =='CANCEL'"> Hủy</p>
            </td>

            <td>{{ audit.createBy}}</td>
            <td>{{ audit.approveNote}}</td>

            <td class="text-center">
              <div class="btn-group">
                <div class="btn-group">
                  <a class="btn btn-warning  btn-sm" style="color: white;margin: auto;" title="Copy"
                    (click)="copyCheckNvl(audit.id, 'NVL')" target="_blank"><i class="fa fa-copy"></i></a>

                  <a *ngIf="audit.status =='DRAFF' || audit.status =='REJECT'" class="btn btn-sm btn-primary"
                    title="Sửa" routerLink="/iqc/iqc-lkdt-check/{{audit.id}}/edit" target="_blank"
                    style="color: white;margin: auto;"><i class="fa fa-edit"></i></a>
                  <button *ngIf="audit.status =='DRAFF' || audit.status =='REJECT' || audit.status ==''"
                    class="btn btn-sm btn-danger" title="Xóa" (click)="delete(audit.id)"
                    style="color: white;margin: auto;"><i class="fa fa-trash"></i></button>
                  <a class="btn btn-sm btn-info" routerLink="/iqc/iqc-lkdt-check/{{audit.id}}/show" title="Chi tiết"
                    target="_blank" style="color: white;margin: auto;"><i class="fa fa-eye"></i></a>
                  <button class="btn btn-sm btn-danger" (click)="report(audit.id, audit.reportCode)"
                    title="Xuất file báo cáo"
                    style="color: white;margin: auto;background-color: #198754; border:#198754 solid 1px"><i
                      class="fa fa-download"></i></button>
                </div>
              </div>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </div>
</div>



<ng-template #elseBlock1>
  <div>
    <h2>Thông tin biên bản kiểm tra LKDT/BTP</h2>
    <div class="card-body">
      <div class="col-xs-12 col-sm-12 pt-3 pb-3"
        *ngIf="typeAction == 'show' && (form.status =='APPROVE' || form.status =='REJECT'||form.status =='CONCESSIONS')">
        <div class="row">
          <h2>Thông tin phê duyệt</h2>
          <div class="col-xs-6 col-sm-6">
            <label>Nhận xét</label>
            <input type="text" readonly="true" class="form-control" placeholder="Tên linh kiện" name="templateCode"
              [(ngModel)]="form.approveNote" />
          </div>
          <div class="col-xs-6 col-sm-6">
            <label>Kết luận</label>
            <input type="text" readonly="true" class="form-control" placeholder="Kết luận" name="statusStr"
              value="{{statusStr}}" [(ngModel)]="statusStr" />
          </div>
        </div>
      </div>

      <div class="row">
        <h2>Thông tin kiểm tra</h2>
      </div>
      <div class="row">
        <div class="col-xs-12 col-sm-12">
          <form name="form" (ngSubmit)="f.form.valid" #f="ngForm">
            <div class="row pb-3">
              <!-- <div *ngIf="isEdit == true" class="col-md-3">
                <label>Mẫu biên bản <i style="color: red;">(*)</i></label>
                <input *ngIf="typeAction =='edit' || typeAction == 'show'" readonly type="text" class="form-control"
                  placeholder="Tên linh kiện" name="templateCode" [(ngModel)]="strSelectElec" />
              </div> -->
              <div *ngIf="isEdit == true" class="col-md-3">
                <label>Mẫu biên bản <i style="color: red;">(*)</i></label>
                <input type="text" class="form-control" [(ngModel)]="selectExamination" value={{strSelect}}
                  [matAutocomplete]="auto" class="form-control" [formControl]="searchExaminationCtrl"
                  placeholder="Mã mẫu biên bản">
                <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onSelected()" [displayWith]="displayWith">
                  <mat-option *ngIf="isLoading" class="is-loading">Loading...</mat-option>
                  <ng-container *ngIf="!isLoading">
                    <mat-option *ngFor="let examination of filteredExamination.lstExamination" [value]="examination">
                      <span><b>{{examination.name}}</b> ({{examination.code}})</span>
                    </mat-option>
                  </ng-container>
                </mat-autocomplete>
              </div>
              <div class="col-md-3">
                <label>Tên biên bản</label>
                <input type="text" class="form-control" placeholder="Số biên bản" name="electCompName"
                  [(ngModel)]="form.electCompName" readonly />
              </div>
              <div class="col-md-3">
                <label>Mã biên bản</label>
                <input type="text" class="form-control" placeholder="Số biên bản" name="elecCompCode"
                  [(ngModel)]="form.elecCompCode" readonly />
              </div>
              <div class="col-md-3">
                <label>Số biên bản<i style="color: red;">(*)</i></label>
                <input type="text" class="form-control" placeholder="Số biên bản" name="reportCode"
                  [(ngModel)]="form.reportCode">
              </div>
            </div>

            <!-- Row 2 -->
            <div class="form-group row">
              <div class="col-md-3">
                <label>Loại hàng<i style="color: red;">(*)</i></label>
                <select class="form-control" name="itemType" [(ngModel)]="form.itemType" #type="ngModel">
                  <option value="Hàng nhập">Hàng nhập</option>
                  <option value="Hàng mẫu">Hàng mẫu</option>
                </select>
              </div>

              <div class="col-md-3" style="width: 12.5%;">
                <mat-label>Ngày nhận hàng <i style="color: red;">(*)</i></mat-label>
                <input class="form-control" type="date" name="importDate"
                  [ngModel]="form.importDate | date:'yyyy-MM-dd'" (ngModelChange)="form.importDate = $event" />
              </div>

              <div class="col-md-3" style="width: 12.5%;">
                <mat-label>Ngày kiểm <i style="color: red;">(*)</i></mat-label>
                <!-- #docregion toggle -->
                <input class="form-control" type="date" name="checkDate" [ngModel]="form.checkDate | date:'yyyy-MM-dd'"
                  (ngModelChange)="form.checkDate = $event" />
              </div>
              <div class="col-md-3">
                <label>Nhà cung cấp</label>
                <input type="text" class="form-control" [(ngModel)]="selectedOrigin" value={{strSelectOrigin}}
                  name="origin" [matAutocomplete]="origin" [formControl]="searchOriginCtrl" placeholder="Nhà cung cấp">

                <mat-autocomplete #origin="matAutocomplete" (optionSelected)="onSelectedOrigin()"
                  [displayWith]="displayWith">
                  <mat-option *ngIf="isLoadingOrigin" class="is-loading">Loading...</mat-option>
                  <ng-container *ngIf="!isLoadingOrigin">
                    <mat-option *ngFor="let oitm of filteredOrigin.lstOcrd" [value]="oitm">
                      <span><b>{{oitm.name}}</b> ({{oitm.code}})</span>
                    </mat-option>
                  </ng-container>
                </mat-autocomplete>
              </div>
              <div class="col-md-3">
                <label>Mã PO </label>
                <input type="text" class="form-control" placeholder="Mã PO" name="grpoNumber"
                  [(ngModel)]="form.grpoNumber" />
              </div>
            </div>
            <div class="form-group row">
              <div class="col-md-3">
                <label>Lập phiếu SPKPH </label>
                <input type="text" class="form-control" placeholder="SPKPH" name="spkphNumber"
                  [(ngModel)]="form.spkphNumber" />
              </div>
              <div class="col-md-3">
                <label>Đề nghị </label>

                <select class="form-control" name="suggestion" [(ngModel)]="form.suggestion" #type="ngModel">
                  <option value="Trả lại nhà cung cấp">Trả lại nhà cung cấp</option>
                  <option value="Nhập kho bình thường">Nhập kho bình thường</option>
                  <option value="Nhập kho có điều kiện">Nhập kho có điều kiện</option>
                </select>
              </div>
              <div class="col-md-3">
                <label>Kết luận</label>

                <select class="form-control" name="conclusion" [(ngModel)]="form.conclusion" #type="ngModel">
                  <option value="Đạt nhập kho">Đạt nhập kho</option>
                  <option value="Không đạt trả về">Không đạt trả về</option>
                  <option value="Nhập kho nhân nhượng">Nhập kho nhân nhượng</option>
                </select>
              </div>
              <div class="col-md-3" style="display: flex;flex-direction: column;">
                <label>Phiếu SPKPH </label>
                <input id="cbx" class="hidden-xs-up" checked="" type="checkbox" name="iqcElectType"
                  [(ngModel)]="form.iqcElectType" style="width: 30px;height: 28px;">
                <label for="cbx" class="cbx"></label>
              </div>
            </div>

            <div class="row pb-3">
              <div class="col-sm-12">
                <label>Ghi chú</label>
                <input type="text" class="form-control" placeholder="Ghi chú" name="note" [(ngModel)]="form.note">
              </div>

            </div>
            <!-- Danh sách item được áp dụng -->
            <div class="table-responsive">
              <div style="display: flex;flex-direction: column;">
                <!-- Danh sách mã hàng hóa -->
                <div class="float-right" style="margin-bottom: 10px;">
                  <button class="btn  btn-success" (click)="addNewItem()"
                    *ngIf="typeAction == 'edit' || typeAction == 'add'"><i class="fa fa-plus"></i> Thêm sản
                    phẩm</button>
                </div>
                <div style="margin-left: 7px;">
                  <div style="margin-bottom: 0px;width: 99%;">
                    <table class="tables" style="margin-bottom: 0px;">
                      <thead>
                        <tr>
                          <th style="width: 4%;">STT</th>
                          <th style="width: 10%;">Mã hàng hóa</th>
                          <th style="width: 29%;">Tên hàng hóa</th>
                          <th style="width: 7%;">Số lượng lô hàng</th>
                          <th style="width: 7%;">Số lô</th>
                          <th style="width: 7%;">Số hóa đơn</th>
                          <th style="width: 7%;">Số lượng kiểm tra ngoại quan</th>
                          <th style="width: 6%;">Thông tin lỗi</th>
                          <th style="width: 15%;">Ghi chú</th>
                          <th style="width: 10%;" *ngIf="typeAction == 'edit' || typeAction == 'add'">Tùy chọn</th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                  <div id="table-body" style="overflow: auto;height: 324px;width: 99%;margin-bottom: 10px;">
                    <table class="tables" style="margin-top: 0px;">
                      <tbody>
                        <tr *ngFor="let item of listOfItem;let i = index;">
                          <td style="width: 4%;"> {{i+1}}</td>
                          <td style="text-align: left;width: 10%;"><input [id]="item.id+'-input'" type="text"
                              [(ngModel)]="item.itemCode" [ngModelOptions]="{ standalone: true }" [hidden]="true"
                              (ngModelChange)="getListOfItems(item.itemCode)" [matAutocomplete]="auto33"
                              style="width: 90%;">
                            <mat-autocomplete [panelWidth]="800" #auto33="matAutocomplete"
                              (optionSelected)="onSelectedElectronic(i,item.itemCode)">
                              <mat-option *ngFor="let oitm of listOfItems" [value]="oitm">
                                <span><b>{{ oitm.itemName }}</b> ({{ oitm.itemCode }})</span>
                              </mat-option>
                            </mat-autocomplete>
                            <span [id]="item.id+'-span'" [hidden]="false">{{item.itemCode}}</span>
                          </td>
                          <td style="text-align: left;width: 29%;"><input [id]="item.id+'-input'" type="text"
                              [(ngModel)]="item.itemName" [ngModelOptions]="{ standalone: true }" [hidden]="true"> <span
                              [id]="item.id+'-span'" [hidden]="false">{{item.itemName}}</span></td>
                          <td style="text-align: left;width: 7%;"> <input [id]="item.id+'-input-po-quantity'"
                              type="text" [(ngModel)]="item.poQuantity" [ngModelOptions]="{ standalone: true }"
                              [hidden]="true" style="width: 90%;"> <span [id]="item.id+'-span-po-quantity'"
                              [hidden]="false">{{item.poQuantity}}</span></td>
                          <td style="text-align: left;width: 7%;"> <input [id]="item.id+'-input-lot-number'" type="text"
                              [(ngModel)]="item.lotNumber" [ngModelOptions]="{ standalone: true }" [hidden]="true"
                              style="width: 90%;"> <span [id]="item.id+'-span-lot-number'"
                              [hidden]="false">{{item.lotNumber}}</span></td>
                          <td style="text-align: left;width: 7%;"> <input [id]="item.id+'-input-bill-number'"
                              type="text" [(ngModel)]="item.billNumber" [ngModelOptions]="{ standalone: true }"
                              [hidden]="true" style="width: 90%;"> <span [id]="item.id+'-span-bill-number'"
                              [hidden]="false">{{item.billNumber}}</span></td>
                          <td style="text-align: left;width: 7%;"> <input [id]="item.id+'-input-quantity-check'"
                              type="text" [(ngModel)]="item.quantityCheck" [ngModelOptions]="{ standalone: true }"
                              [hidden]="true" style="width: 90%;"> <span [id]="item.id+'-span-quantity-check'"
                              [hidden]="false">{{item.quantityCheck}}</span></td>
                          <td style="width: 6%;"><button class="btn btn-sm btn-primary" title="Chi tiết lỗi"
                              style="background-color: #0dcaf0;border:#0dcaf0"
                              (click)="openPopupError(listError,item)"><i class="fa fa-eye"></i></button> </td>
                          <td style="text-align: left;width: 15%;"> <input [id]="item.id+'-input-note'" type="text"
                              [(ngModel)]="item.note" [ngModelOptions]="{ standalone: true }" [hidden]="true"
                              style="width: 90%;"> <span [id]="item.id+'-span-note'"
                              [hidden]="false">{{item.note}}</span></td>
                          <td style="width: 10%;" *ngIf="typeAction == 'edit' || typeAction == 'add'">
                            <button class="btn btn-sm btn-primary" title="Sửa" (click)="updateItem(item.id)"><i
                                class="fa fa-edit"></i></button>
                            <button [id]="item.id+'-button'" class="btn btn-sm btn-info" title="Xác nhận"
                              [hidden]="true" (click)="submitItem(i)"><i class="fa fa-check"></i></button>
                            <button class="btn btn-sm btn-danger" title="Xóa" (click)="deleteById(i)"><i
                                class="fa fa-trash"></i></button>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>


            <!-- thong tin kiem tra nvl -->

            <div class="float-right btn-group" style="margin-bottom: 10px;">
              <button class="btn  btn-primary" (click)="open(thongso,'','')"
                *ngIf=" typeAction == 'edit' || typeAction =='add' "><i class="fa fa-plus"></i> Thông số kiểm
                tra</button>
              <button class="btn  btn-success" (click)="open(tieuchi,'','')"
                *ngIf=" typeAction == 'edit' || typeAction =='add' "><i class="fa fa-plus"></i> Thêm tiêu chí kiểm
                tra</button>
              <button class="btn  btn-danger" (click)="open(myModalError,'','')" style="margin-right: 10px;"
                [hidden]="true"><i class="fa fa-plus"></i>
                <span *ngIf=" typeAction == 'edit' || typeAction =='add'; else show ">Thêm thông tin lỗi</span>
                <ng-template #show>Thông tin lỗi</ng-template>
              </button>
              <button class="btn  btn-danger"
                *ngIf=" typeAction == 'edit'||  typeAction == 'add'||  typeAction == 'show'"
                style="margin-right: 10px; border-radius:8px" (click)="openPopupError(listErrorView,null)"><i
                  class="fa fa-list"></i>
                Danh sách lỗi</button>
              <button class="btn btn-success" style="border-radius:8px" *ngIf=" typeAction == 'show'"
                (click)="exportExcelDetail()" type="submit">
                <i class="fa fa-download"></i> Xuất excel
              </button>
            </div>

            <nz-table #borderedTable nzBordered nzTitle="Thông tin tiêu chí" [nzData]="['']"
              [nzScroll]="{ x: '3700px' }" [nzFrontPagination]="false">
              <thead>
                <!-- <tr>
                  <th rowspan="2" style="width: 2%;" nzLeft>STT</th>
                  <th rowspan="2" style="width: 4%;" nzLeft>Tiêu chí kiểm tra</th>
                  <th rowspan="2" style="width: 4%;" nzLeft>Bậc rút nghiệm</th>
                  <th rowspan="2" style="width: 4%;" nzLeft>Mức chấp nhận</th>
                  <th colspan="3" style="width: 9%;">Yêu cầu kiểm tra</th>
                  <th rowspan="2" style="line-height: 65px">Yêu cầu chi tiết, lưu ý</th>
                  <th rowspan="2" style="line-height: 65px;width: 5%;">Số lượng kiểm tra</th>
                  <th rowspan="2" style="line-height: 65px;width: 4%;">Số lỗi thực tế</th>
                  <th colspan="2" style="width: 8%;">Kết quả kiểm tra</th>
                  <th rowspan="2" style="line-height: 65px;width: 5.5%;">Đánh giá</th>
                  <th rowspan="2" style="line-height: 65px">Ghi chú</th>
                  <th rowspan="2" style="line-height: 65px;width: 3.5%;" nzRight>Tùy chọn</th>
                </tr>
                <tr>
                  <th>Min</th>
                  <th>Max</th>
                  <th>Đơn vị</th>
                  <th style="text-align: center;">Min</th>
                  <th style="text-align: center;">Max</th>
                </tr> -->
                <tr>
                  <th [colspan]="1" class="set-color-background" style="width: 2%;" nzLeft>STT</th>
                  <th [colspan]="1" class="set-color-background" style="width: 4%;" nzLeft>Tiêu chí kiểm tra</th>
                  <th [colspan]="1" class="set-color-background" style="width: 4%;" nzLeft>Bậc rút nghiệm</th>
                  <th [colspan]="1" class="set-color-background" style="width: 4%;" nzLeft>Mức chấp nhận</th>
                  <th [colspan]="3" class="set-color-background" style="width: 9%;" nzLeft>Yêu cầu kiểm tra</th>
                  <th rowspan="2" class="set-color-background" style="line-height: 65px">Yêu cầu chi tiết, lưu ý
                  </th>
                  <th rowspan="2" class="set-color-background" style="line-height: 65px;width: 5%;">Số lượng kiểm
                    tra</th>
                  <th rowspan="2" class="set-color-background" style="line-height: 65px;width: 4%;">Số lỗi thực tế
                  </th>
                  <th colspan="2" class="set-color-background" style="width: 8%;">Kết quả kiểm tra</th>
                  <th rowspan="2" class="set-color-background" style="line-height: 65px;width: 5.5%;">Đánh giá</th>
                  <th rowspan="2" class="set-color-background" style="line-height: 65px">Ghi chú</th>
                  <th rowspan="2" class="set-color-background" style="line-height: 65px; width: 3.5%;" nzRight>Tùy
                    chọn
                  </th>
                </tr>
                <tr>
                  <th class="set-color-background" nzLeft></th>
                  <th class="set-color-background" nzLeft></th>
                  <th class="set-color-background" nzLeft></th>
                  <th class="set-color-background" nzLeft></th>
                  <th class="set-color-background" nzLeft>Min</th>
                  <th class="set-color-background" nzLeft>Max</th>
                  <th class="set-color-background" nzLeft>Đơn vị</th>
                  <th class="set-color-background">Min</th>
                  <th class="set-color-background">Max</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let auditLKDT of lstAuditCriteriaLKDT;let i = index;">
                  <td nzLeft>{{ auditLKDT.positionNumber }}</td>
                  <td nzLeft>{{ auditLKDT.auditContent }}</td>
                  <td nzLeft>{{ auditLKDT.regulationLevel }}</td>
                  <td nzLeft>{{ auditLKDT.acceptanceLevel }}</td>
                  <td nzLeft>{{ auditLKDT.min }}</td>
                  <td nzLeft>{{ auditLKDT.max }}</td>
                  <td nzLeft>{{ auditLKDT.unit }}</td>
                  <td>{{ auditLKDT.technicalRequirement}}</td>
                  <td>
                    <input type="text" placeholder="Số lượng" class="form-control" name="auditQuantity[{{i}}]"
                      [(ngModel)]="auditLKDT.auditQuantity">

                  </td>
                  <td>
                    <input type="text" placeholder="Sai số" class="form-control" name="inaccuracy[{{i}}]"
                      [(ngModel)]="auditLKDT.inaccuracy">
                  </td>
                  <td> <input type="text" placeholder="Min" class="form-control" name="minAudit[{{i}}]"
                      [(ngModel)]="auditLKDT.minAudit"></td>
                  <td><input type="text" placeholder="Max" class="form-control" name="maxAudit[{{i}}]"
                      [(ngModel)]="auditLKDT.maxAudit"></td>
                  <td>
                    <select class="form-control" name="checkResult[{{i}}]" [(ngModel)]="auditLKDT.checkResult"
                      #type="ngModel">
                      <option value="Đạt">Đạt nhập kho</option>
                      <option value="Không đạt">Không đạt trả về</option>
                      <option value="Nhân nhượng">Nhập kho nhân nhượng</option>
                    </select>
                  </td>
                  <td>
                    <input type="text" placeholder="Ghi chú" class="form-control" name="checkContent[{{i}}]"
                      [(ngModel)]="auditLKDT.checkContent">
                  </td>

                  <td nzRight>
                    <button class="btn btn-info" *ngIf=" typeAction == 'edit'||  typeAction == 'add'" title="Chỉnh sửa"
                      (click)="open(tieuchi,'edit',i)"><i class="fa fa-edit"></i></button>
                    <button *ngIf=" typeAction == 'edit' || typeAction =='add' " class="btn btn-danger" type="button"
                      (click)="removeAuditLKDT(auditLKDT.auditContent,auditLKDT.id)"><i
                        class="fa fa-trash"></i></button>
                  </td>
                </tr>
              </tbody>
            </nz-table>

            <nz-table #borderedTable nzBordered nzTitle="Thông tin tiêu chí" [nzData]="['']"
              [nzScroll]="{ x: '3200px' }" [nzFrontPagination]="false">
              <thead>
                <tr>
                  <th [colspan]="1" class="set-color-background" style="width: 2%;" nzLeft>STT</th>
                  <th [colspan]="1" class="set-color-background" style="width: 6%;" nzLeft>Thông số kiểm tra</th>
                  <th [colspan]="1" class="set-color-background" style="width: 5%;" nzLeft>Điều kiện kiểm tra</th>
                  <th [colspan]="3" class="set-color-background" style="width: 9%;" nzLeft>Tiêu chuẩn kiểm tra</th>
                  <th rowspan="2" class="set-color-background" style="width: 4.2%;">Q Trung bình</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">Số lượng</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">Min</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">Max</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">Trung bình</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">S</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">KU</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">KL</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">KMin</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">CPK up</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">CPK Low</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">CPK</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;">Đánh giá</th>
                  <th rowspan="2" class="set-color-background">Nội dung</th>
                  <th rowspan="2" class="set-color-background" style="width: 4%;" nzRight>Tùy chọn</th>
                </tr>
                <tr>
                  <th class="set-color-background" nzLeft></th>
                  <th class="set-color-background" nzLeft></th>
                  <th class="set-color-background" nzLeft></th>
                  <th class="set-color-background" nzLeft>Min</th>
                  <th class="set-color-background" nzLeft>Max</th>
                  <th class="set-color-background" nzLeft>Đơn vị</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let auditLKDT of lstAuditCriteriaParam;let i = index;">
                  <td nzLeft>{{ auditLKDT.positionNumber}}</td>
                  <td nzLeft>{{ auditLKDT.parameterName }}</td>
                  <td nzLeft>{{ auditLKDT.conditions }}</td>
                  <td nzLeft>{{ auditLKDT.min | number }}</td>
                  <td nzLeft>{{ auditLKDT.max | number }}</td>
                  <td nzLeft>{{ auditLKDT.unit }}</td>
                  <td>
                    <input type="text" placeholder="Q trung bình" class="form-control" name="auditQAvg[{{i}}]"
                      [(ngModel)]="auditLKDT.auditQAvg" readonly>
                  </td>
                  <td>
                    <input type="text" placeholder="Số lượng" class="form-control" name="quantity[{{i}}]"
                      [(ngModel)]="auditLKDT.quantity" readonly>
                  </td>

                  <td>
                    <input type="text" placeholder="Min" class="form-control" name="minAudit{{i}}]"
                      [(ngModel)]="auditLKDT.minAudit" readonly>
                  </td>

                  <td>
                    <input type="text" placeholder="Max" class="form-control" name="maxAudit{{i}}]"
                      [(ngModel)]="auditLKDT.maxAudit" readonly>
                  </td>

                  <td>
                    <input type="text" placeholder="Trung bình" class="form-control" name="avgResult[{{i}}]"
                      [(ngModel)]="auditLKDT.avgResult" readonly>
                  </td>

                  <td>
                    <input type="text" placeholder="S" class="form-control" name="s[{{i}}]" [(ngModel)]="auditLKDT.s"
                      readonly>
                  </td>
                  <td>
                    <input type="text" placeholder="KU" class="form-control" name="ku[{{i}}]" [(ngModel)]="auditLKDT.ku"
                      readonly>
                  </td>
                  <td>
                    <input type="text" placeholder="KL" class="form-control" name="kl[{{i}}]" [(ngModel)]="auditLKDT.kl"
                      readonly>
                  </td>

                  <td>
                    <input type="text" placeholder="Kmin" class="form-control" name="kmin[{{i}}]"
                      [(ngModel)]="auditLKDT.kmin" readonly>
                  </td>
                  <td>
                    <input type="text" placeholder="CPK up" class="form-control" name="cpkUp[{{i}}]"
                      [(ngModel)]="auditLKDT.cpkUp" readonly>
                  </td>
                  <td>
                    <input type="text" placeholder="CPK Low" class="form-control" name="cpkLow[{{i}}]"
                      [(ngModel)]="auditLKDT.cpkLow" readonly>
                  </td>
                  <td>
                    <input type="text" placeholder="CPK" class="form-control" name="cpk[{{i}}]"
                      [(ngModel)]="auditLKDT.cpk" readonly>
                  </td>

                  <td>
                    <select class="form-control" name="checkResult[{{i}}]" [(ngModel)]="auditLKDT.checkResult"
                      #type="ngModel">
                      <option value="Đạt">Đạt</option>
                      <option value="Không đạt">Không đạt</option>
                      <option value="Nhân nhượng">Nhân nhượng</option>
                    </select>
                  </td>
                  <td>
                    <input type="text" placeholder="Ghi chú" class="form-control" name="content[{{i}}]"
                      [(ngModel)]="auditLKDT.content">
                  </td>

                  <td nzRight>
                    <button *ngIf=" typeAction == 'edit' || typeAction =='add' " class="btn btn-info" type="button"
                      (click)="open(thongso,'edit',i)"><i class="fa fa-edit"></i></button>
                    <button *ngIf=" typeAction == 'edit' || typeAction =='add' " class="btn btn-danger" type="button"
                      (click)="removeAuditParam(auditLKDT.parameterName,auditLKDT.id)"><i
                        class="fa fa-trash"></i></button>
                  </td>
                </tr>
              </tbody>
            </nz-table>

            <div class="form-group row" *ngIf=" typeAction == 'edit' || typeAction =='add' ">
              <div class="col-md-4">
                <label>Số liệu kiểm tra </label>
                <input type="file" (change)="addfile($event)" placeholder="Upload file"
                  accept=".csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
              </div>
              <div class="col-md-4">
                <button class="btn btn-success" (click)="downloadTemplate()">
                  <i class="fa fa-download"></i> Tải mẫu
                </button>
                <label> Vui lòng chọn mẫu biên bản trước khi tải mẫu</label>
              </div>
            </div>

            <div class="form-group" style="margin-top: 20px;">
              <button class="btn btn-default" routerLink="/iqc/iqc-lkdt-check"><i class="fa fa-list"></i> Danh
                sách</button>

              <button *ngIf="typeAction =='add' || typeAction =='edit'" class="btn btn-primary" type="submit"
                (click)="onSubmit('save')">
                <i class="fa fa-save"></i>
                <span *ngIf="typeAction =='add'"> Thêm mới biên bản</span>
                <span *ngIf="typeAction =='edit'"> Cập nhật thông tin</span>
              </button>

              <button *ngIf="typeAction =='add' || typeAction =='edit'" class="btn btn-info" type="submit"
                style="margin-left: 30px" (click)="onSubmit('send_approve')">
                <i class="fa fa-check"></i>
                Gửi duyệt
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</ng-template>




<!-- thong tin kiem tra nvl -->
<ng-template #myModalError let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Khai báo lỗi</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <form name="form" (ngSubmit)="f.form.valid && onAddErrorChild()" #f="ngForm" novalidate
      *ngIf=" typeAction == 'edit' || typeAction =='add' ">
      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <label>Chọn nhóm lỗi</label>
            <select required class="form-control" #errGroup="ngModel"
              (change)="onChangeErrorGroup(formErrorChild.errGroup)" name="errGroup"
              [(ngModel)]="formErrorChild.errGroup" #type="ngModel">
              <option *ngFor="let error of lstErrorGr; let idx = index" [value]="error.name">{{error.name}}</option>
            </select>

            <div class="alert-danger" *ngIf="errGroup.errors && f.submitted">
              <div *ngIf="errGroup.errors['required']">Nhóm lỗi không được để trống</div>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-group">
            <label>Chọn lỗi</label>
            <select required class="form-control" name="errName" [(ngModel)]="formErrorChild.errName" #type="ngModel"
              #errName="ngModel">
              <option *ngFor="let error of lstError; let idx = index" [value]="error.name">{{error.name}}</option>
            </select>
            <div class="alert-danger" *ngIf="errName.errors && f.submitted">
              <div *ngIf="errName.errors['required']">Tên lỗi không được để trống</div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <label>Số lượng</label>
            <input required="" type="number" (change)="onChangeQuantityError(formErrorChild.quantity)"
              class="form-control" name="regulationNevel" [(ngModel)]="formErrorChild.quantity" required
              #level="ngModel" placeholder="Số lượng lỗi" #quantity="ngModel" />
            <div class="alert-danger" *ngIf="quantity.errors && f.submitted">
              <div *ngIf="quantity.errors['required']">Số lượng kiểm tra không được để trống</div>
            </div>
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>Tỷ lệ lỗi</label>
            <input readonly type="text" class="form-control" name="ratio" [(ngModel)]="formErrorChild.ratio"
              #level="ngModel" placeholder="tỷ lệ lỗi" />

            <label style="color: red;">{{errorAdd}}</label>
          </div>
        </div>
      </div>


      <div class="form-group">
        <label>Serial</label>
        <input type="text" class="form-control" name="regulationNevel" [(ngModel)]="formErrorChild.serial"
          #level="ngModel" placeholder="Serial" #quantity="ngModel" />
      </div>

      <div class="form-group">
        <label>Tỷ lệ lỗi</label>
        <input readonly type="text" class="form-control" name="ratio" [(ngModel)]="formErrorChild.ratio"
          #level="ngModel" placeholder="tỷ lệ lỗi" />

        <label style="color: red;">{{errorAdd}}</label>
      </div>
      <div class="form-group">
        <button class="btn btn-success" type="submit">Thêm mới</button>
      </div>
    </form>

    <nz-table #borderedTable nzBordered nzTitle="Thông tin lỗi kiểm tra" [nzData]="['']" [nzFrontPagination]="false">
      <thead>
        <tr>
          <th>Loại lỗi</th>
          <th>Tên lỗi</th>
          <th>Số lượng</th>
          <th>Tỷ lệ lỗi</th>
          <th width="50px">Tùy chọn</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let error of arrErrChild">
          <td>{{ error.errGroup }}</td>
          <td>{{ error.errName }}</td>
          <td>{{ error.quantity }}</td>
          <td>{{ error.ratio }}</td>
          <td>
            <button class="btn btn-sm btn-danger" (click)="deleteErrorRow(error.ids)"
              *ngIf=" typeAction == 'edit' || typeAction =='add' "><i class="fa fa-trash"></i>
              Xóa</button>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>
</ng-template>


<ng-template #tieuchi let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Thêm mới tiêu chí</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <form name="form" (ngSubmit)="f.form.valid " #f="ngForm" novalidate>
      <div class="row">
        <label>Số thứ tự</label>
        <input type="text" class="form-control  {{ !positionNumber.valid ? 'is-invalid' :''}}"
          [(ngModel)]="formAuditCriteriaLKDT.positionNumber" #positionNumber="ngModel" required
          [ngModelOptions]="{ standalone: true }" placeholder="Số thứ tự" (change)="checkDuplicateNumber('LKDT')" />
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label>Nhóm tiêu chí</label>
            <input type="text" class="form-control" [(ngModel)]="testingCriticalGroup"
              [ngModelOptions]="{ standalone: true }" #criteriaName="ngModel" placeholder="Tiêu chí"
              list="testingCriticalGroup" (change)="findByCritiCalGroup()" />
            <datalist id="testingCriticalGroup">
              <option *ngFor="let oitm of listOfCriticalGroup" [value]="oitm.testingCriticalGroup">
                <span>{{ oitm.testingCriticalGroup }}</span>
              </option>
            </datalist>
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>Chỉ tiêu kiểm tra</label>
            <input type="text" class="form-control {{ !criteriaName1.valid ? 'is-invalid' :''}}"
              [(ngModel)]="formAuditCriteriaLKDT.auditContent" #criteriaName1="ngModel" required
              [ngModelOptions]="{ standalone: true }" placeholder="Chỉ tiêu kiểm tra" list="criteriaName1" />
            <datalist id="criteriaName1">
              <option *ngFor="let item of listOfCriticalName" [value]="item.testingName">
                <span>{{ item.testingName }}</span>
              </option>
            </datalist>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <label>Bậc rút nghiệm</label>
            <input type="text" class="form-control {{ !regulationLevel.valid ? 'is-invalid' :''}}"
              name="regulationLevel" #regulationLevel="ngModel" required
              [(ngModel)]="formAuditCriteriaLKDT.regulationLevel" placeholder="Mức quy định" />
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>Mức chấp nhận</label>
            <input type="text" class="form-control" name="acceptanceLevel"
              [(ngModel)]="formAuditCriteriaLKDT.acceptanceLevel" placeholder="Mức quy định" />
          </div>
        </div>
      </div>


      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <label>Yêu cầu chi tiết/Lưu ý</label>
            <input type="text" class="form-control" name="technicalRequirement"
              [(ngModel)]="formAuditCriteriaLKDT.technicalRequirement" placeholder="Yêu cầu chi tiết/Lưu ý" />
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label> Số lượng</label>
            <input type="text" class="form-control" name="auditQuantity"
              [(ngModel)]="formAuditCriteriaLKDT.auditQuantity" placeholder="Số lượng" />
          </div>
        </div>
      </div>


      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <label>Sai số thực tế</label>
            <input type="text" class="form-control" name="inaccuracy" [(ngModel)]="formAuditCriteriaLKDT.inaccuracy"
              placeholder="Sai số thực tế" />

          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label> Đánh giá</label>
            <select class="form-control" name="checkResult" [(ngModel)]="formAuditCriteriaLKDT.checkResult"
              #type="ngModel">
              <option value="Đạt">Đạt</option>
              <option value="Không đạt">Không đạt</option>
              <option value="Nhân nhượng">Nhân nhượng</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label> Ghi chú</label>
        <input type="text" class="form-control" name="checkContent" [(ngModel)]="formAuditCriteriaLKDT.checkContent"
          placeholder="Ghi chú" />
      </div>

      <div class="form-group">
        <button id="btn-update" class="btn btn-success" type="submit" style="margin-top: 10px;"
          [disabled]="!(f.form.valid)" (click)="addAuditCriterialLKDT('')">
          <i class="fa fa-edit"></i> Cập nhật
        </button>
      </div>
      <div class="form-group">
        <button id="btn-insert" class="btn btn-success" type="submit" [disabled]="!(f.form.valid) "
          (click)="addAuditCriterialLKDT(null)">Thêm mới</button>
      </div>
    </form>
  </div>
</ng-template>


<ng-template #thongso let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Khai báo thông số</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <form name="form" (ngSubmit)="f.form.valid" #f="ngForm" novalidate>
      <div class="row">
        <label>Số thứ tự</label>
        <input type="text" class="form-control  {{ !positionNumber1.valid ? 'is-invalid' :''}}"
          [(ngModel)]="formAuditParam.positionNumber" #positionNumber1="ngModel" required
          [ngModelOptions]="{ standalone: true }" placeholder="Số thứ tự" (change)="checkDuplicateNumber('TS')" />
      </div>
      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <label>Thông số kiểm tra</label>
            <input type="text" class="form-control  {{ !parameterName1.valid ? 'is-invalid' :''}}" name="parameterName"
              [(ngModel)]="formAuditParam.parameterName" placeholder="Thông số" list="parameter"
              #parameterName1="ngModel" required />
            <datalist id="parameter">
              <option *ngFor="let oitm of listOfParameters" [value]="oitm.testingName">
                <span>{{ oitm.testingName }}</span>
              </option>
            </datalist>

          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>Điều kiện kiểm tra</label>
            <input type="text" class="form-control" name="conditions" [(ngModel)]="formAuditParam.conditions"
              placeholder="Điều kiện" />
          </div>
        </div>
      </div>


      <div class="row">
        <div class="col-sm-4">
          <div class="form-group">
            <label>Tiêu chuẩn min</label>
            <input required="" type="text" class="form-control" name="min" [(ngModel)]="formAuditParam.min"
              placeholder="Tiêu chuẩn min" />
          </div>
        </div>

        <div class="col-sm-4">
          <div class="form-group">
            <label> Tiêu chuẩn max</label>
            <input type="text" class="form-control" name="max" [(ngModel)]="formAuditParam.max"
              placeholder="Tiêu chuẩn max" />
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label> Đơn vị</label>
            <input type="text" class="form-control" name="unit" [(ngModel)]="formAuditParam.unit"
              placeholder="Đơn vị" />
          </div>
        </div>
      </div>


      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <label>Q trung bình</label>
            <input type="text" placeholder="Q trung bình" class="form-control" name="auditQAvg"
              [(ngModel)]="formAuditParam.auditQAvg">

          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label> Số lượng</label>
            <input type="text" placeholder="Số lượng" class="form-control" name="quantity"
              [(ngModel)]="formAuditParam.quantity">
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-4">
          <div class="form-group">
            <label>Max</label>
            <input type="text" placeholder="Max" class="form-control" name="maxAudit"
              [(ngModel)]="formAuditParam.maxAudit">

          </div>
        </div>

        <div class="col-sm-4">
          <div class="form-group">
            <label>Min</label>
            <input type="text" placeholder="Min" class="form-control" name="minAudit"
              [(ngModel)]="formAuditParam.minAudit">
          </div>
        </div>

        <div class="col-sm-4">
          <div class="form-group">
            <label>Trung bình</label>
            <input type="text" placeholder="Trung bình" class="form-control" name="avgResult"
              [(ngModel)]="formAuditParam.avgResult">
          </div>
        </div>
      </div>



      <div class="row">
        <div class="col-sm-4">
          <div class="form-group">
            <label>S</label>
            <input type="text" placeholder="S" class="form-control" name="s" [(ngModel)]="formAuditParam.s">

          </div>
        </div>

        <div class="col-sm-4">
          <div class="form-group">
            <label>KU</label>
            <input type="text" placeholder="KU" class="form-control" name="ku" [(ngModel)]="formAuditParam.ku">
          </div>
        </div>

        <div class="col-sm-4">
          <div class="form-group">
            <label>KL</label>
            <input type="text" placeholder="KL" class="form-control" name="kl" [(ngModel)]="formAuditParam.kl">
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-4">
          <div class="form-group">
            <label>Kmin</label>
            <input type="text" placeholder="Kmin" class="form-control" name="kmin" [(ngModel)]="formAuditParam.kmin">

          </div>
        </div>

        <div class="col-sm-4">
          <div class="form-group">
            <label>CPKUP</label>
            <input type="text" placeholder="CPK up" class="form-control" name="cpkUp"
              [(ngModel)]="formAuditParam.cpkUp">
          </div>
        </div>

        <div class="col-sm-4">
          <div class="form-group">
            <label>CPK Low</label>
            <input type="text" placeholder="CPK Low" class="form-control" name="cpkLow"
              [(ngModel)]="formAuditParam.cpkLow">
          </div>
        </div>
      </div>


      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <label>CPK</label>
            <input type="text" placeholder="CPK" class="form-control" name="cpk" [(ngModel)]="formAuditParam.cpk">
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>Kết luận</label>
            <select class="form-control" name="checkResult" [(ngModel)]="formAuditParam.checkResult" #type="ngModel">
              <option value="Đạt">Đạt</option>
              <option value="Không đạt">Không đạt</option>
              <option value="Nhân nhượng">Nhân nhượng</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label> Ghi chú</label>
        <input type="text" placeholder="Ghi chú" class="form-control" name="content"
          [(ngModel)]="formAuditParam.content">
      </div>


      <div class="form-group">
        <button id="btn-insert" class="btn btn-success" type="submit" (click)="addAuditCriterialParam(null)">Thêm
          mới</button>
        <button id="btn-update" class="btn btn-success" type="submit" (click)="addAuditCriterialParam('')">Cập
          nhật</button>
      </div>
    </form>
  </div>
</ng-template>
<!-- Khai báo lỗi biên bản nvl -->
<ng-template #listError let-modal>
  <div style="width: 190%;background: #fff;position: absolute;left: -41%;border-radius: 9px;">
    <div> <button class="close-popup" style="margin-left: 97%;" (click)="modal.dismiss('Cross click')">X</button></div>
    <div style="margin-left: 10px; font-size: 19px;margin-bottom: 10px;"><b>Danh sách lỗi</b></div>
    <div style="display: flex;justify-content: space-between;width: 98%;margin: auto;">
      <div style="display: flex;">
        <div class="column-table-check-nvl">Mã hàng hóa <br> <input type="text" class="input-errors"
            [(ngModel)]="itemCode" [ngModelOptions]="{ standalone: true }" (ngModelChange)="getLstItemCode()"
            list="lstItemCode">
          <datalist id="lstItemCode">
            <option *ngFor="let item of lstItemCode" value="{{item.itemCode}}"></option>
          </datalist>
        </div>
        <div class="column-table-check-nvl">Nhóm lỗi <br> <input type="text" class="input-errors" [(ngModel)]="errGroup"
            [ngModelOptions]="{ standalone: true }" (ngModelChange)="getLstErrGroup()" list="lstErrGroup">
          <datalist id="lstErrGroup">
            <option *ngFor="let item of lstErrGroup" value="{{item.errGroup}}"></option>
          </datalist>
        </div>
        <div class="column-table-check-nvl">Mã lỗi <br> <input type="text" class="input-errors" [(ngModel)]="errCode"
            [ngModelOptions]="{ standalone: true }" (ngModelChange)="getLstErrCode()" list="lstErrCode">
          <datalist id="lstErrCode">
            <option *ngFor="let item of lstErrCode" value="{{item.errCode}}"></option>
          </datalist>
        </div>
        <div class="column-table-check-nvl">Tên lỗi <br> <input type="text" class="input-errors" [(ngModel)]="errName"
            [ngModelOptions]="{ standalone: true }" (ngModelChange)="getLstErrName()" list="lstErrName">
          <datalist id="lstErrName">
            <option *ngFor="let item of lstErrName" value="{{item.errName}}"></option>
          </datalist>
        </div>
        <button class="btn  btn-success" style="height: 40px;background-color: #0dcaf0;border:#0dcaf0;margin-top:22px"
          (click)="findInListErrors()"><i class="fa fa-search"></i>Tìm kiếm</button>
      </div>
      <div class="float-right">
        <!-- <button id="btn-save-item" (click)="submitErrors()" class="btn  btn-success"
          style="background-color: #0d6efd;margin-left: 10px;border: #0d6efd solid 1px;" [hidden]="true"><i
            class="fa fa-save"></i> Lưu</button> -->
        <button class="btn  btn-success" style="height: 40px;margin-top:22px" (click)="addNewError()"
          *ngIf="typeAction == 'edit' || typeAction == 'add'"><i class="fa fa-plus"></i> Thêm Lỗi</button>
      </div>
    </div>
    <div style="margin-left: 7px;">
      <div style="margin-bottom: 0px;width: 99%;">
        <table class="tables" style="margin-bottom: 0px;">
          <thead>
            <tr>
              <th style="width: 5%;">STT</th>
              <th style="width: 9%;">Mã hàng hóa </th>
              <th style="width: 9%;">Nhóm lỗi </th>
              <th style="width: 9%;">Mã lỗi </th>
              <th style="width: 21%;">Tên lỗi </th>
              <th style="width: 9%;">Số lượng</th>
              <th style="width: 9%;">Ngày thêm</th>
              <th style="width: 19%;">Ghi chú</th>
              <th style="width: 9%;" *ngIf="typeAction == 'edit' || typeAction == 'add'">Tùy chọn</th>
            </tr>
          </thead>
        </table>
      </div>
      <div id="table-errors" style="width: 99%;margin-bottom: 10px;">
        <table class="tables" style="margin-top: 0px;">
          <tbody>
            <tr *ngFor="let item of listOfError;let i = index;">
              <td style="width: 5%;"> {{i+1}}</td>
              <td style="text-align: left;width: 9%;">{{item.itemCode}}</td>
              <td style="text-align: left;width: 9%;">
                <select required class="form-control" #errGroup="ngModel" [id]="item.id+'-input-error-errGroup'"
                  (change)="onChangeErrorGroup(item.errGroup)" [ngModelOptions]="{ standalone: true }" [hidden]="true"
                  [(ngModel)]="item.errGroup" #type="ngModel">
                  <option *ngFor="let error of lstErrorGr; let idx = index" [value]="error.name">{{error.name}}</option>
                </select>
                <span [id]="item.id+'-span-error-errGroup'" [hidden]="false">{{item.errGroup}}</span>
              </td>
              <td style="text-align: left;width: 9%;">{{item.errCode}}</td>
              <td style="text-align: left;width: 21%;">

                <select required class="form-control" [id]="item.id+'-input-error-errCode'" [(ngModel)]="item.errName"
                  [ngModelOptions]="{ standalone: true }" [hidden]="true" #type="ngModel" #errName="ngModel"
                  (ngModelChange)="mappingErrCode(item.errName,i)">
                  <option [value]="item.errName">{{item.errName}}</option>
                  <option *ngFor="let error of lstError; let idx = index" [value]="error.name">{{error.name}}</option>
                </select>
                <span [id]="item.id+'-span-error-errCode'" [hidden]="false">{{item.errName}}</span>
              </td>
              <td style="width: 9%;"><input [id]="item.id+'-input-quantity'" type="text" style="width: 90%;"
                  [(ngModel)]="item.quantity" [ngModelOptions]="{ standalone: true }" [hidden]="true"> <span
                  [id]="item.id+'-span-quantity'" [hidden]="false">{{item.quantity}}</span></td>
              <td style="width: 9%;">{{item.createdAt| date:'dd/MM/yyyy'}}</td>
              <td style="text-align: left;width: 19%;"> <input [id]="item.id+'-input-error-note'" type="text"
                  [(ngModel)]="item.note" [ngModelOptions]="{ standalone: true }" [hidden]="true" style="width: 90%;">
                <span [id]="item.id+'-span-error-note'" [hidden]="false">{{item.note}}</span>
              </td>
              <td style="width: 9%;" *ngIf="typeAction == 'edit' || typeAction == 'add'">
                <button class="btn btn-sm btn-primary" title="Sửa" (click)="updateError(item.id,item.errGroup)"><i
                    class="fa fa-edit"></i></button>
                <button [id]="item.id+'-button-error'" class="btn btn-sm btn-info" title="Xác nhận" [hidden]="true"
                  (click)="submitError(i)"><i class="fa fa-check"></i></button>
                <button class="btn btn-sm btn-danger" title="Xóa" (click)="deleteErrorById(i)"><i
                    class="fa fa-trash"></i></button>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</ng-template>
<!-- View lỗi biên bản nvl -->
<ng-template #listErrorView let-modal>
  <div style="width: 190%;background: #fff;position: absolute;left: -41%;border-radius: 9px;">
    <div> <button class="close-popup" style="margin-left: 97%;" (click)="modal.dismiss('Cross click')">X</button></div>
    <div style="margin-left: 10px; font-size: 19px;margin-bottom: 10px;"><b>Danh sách lỗi</b></div>
    <div style="display: flex;justify-content: space-between;width: 98%;margin: auto;">
      <div style="display: flex;">
        <div hidden>Mã hàng hóa <br> <input type="text" class="input-errors" [(ngModel)]="itemCode"
            [ngModelOptions]="{ standalone: true }" (ngModelChange)="getLstItemCode()" list="lstItemCode">
          <datalist id="lstItemCode">
            <option *ngFor="let item of lstItemCode" value="{{item.itemCode}}"></option>
          </datalist>
        </div>
        <div hidden>Nhóm lỗi <br> <input type="text" class="input-errors" [(ngModel)]="errGroup"
            [ngModelOptions]="{ standalone: true }" (ngModelChange)="getLstErrGroup()" list="lstErrGroup">
          <datalist id="lstErrGroup">
            <option *ngFor="let item of lstErrGroup" value="{{item.errGroup}}"></option>
          </datalist>
        </div>
        <div hidden>Mã lỗi <br> <input type="text" class="input-errors" [(ngModel)]="errCode"
            [ngModelOptions]="{ standalone: true }" (ngModelChange)="getLstErrCode()" list="lstErrCode">
          <datalist id="lstErrCode">
            <option *ngFor="let item of lstErrCode" value="{{item.errCode}}"></option>
          </datalist>
        </div>
        <div hidden>Tên lỗi <br> <input type="text" class="input-errors" [(ngModel)]="errName"
            [ngModelOptions]="{ standalone: true }" (ngModelChange)="getLstErrName()" list="lstErrName">
          <datalist id="lstErrName">
            <option *ngFor="let item of lstErrName" value="{{item.errName}}"></option>
          </datalist>
        </div>
        <button hidden class="btn  btn-success" style="height: 40px;background-color: #0dcaf0;border:#0dcaf0"
          (click)="findInListErrors()"><i class="fa fa-search"></i>Tìm kiếm</button>
      </div>
      <div class="float-right">
      </div>
    </div>
    <div style="margin-left: 7px;">
      <div style="margin-bottom: 0px;width: 99%;">
        <table class="tables" style="margin-bottom: 0px;">
          <thead>
            <tr>
              <th style="width: 5%;">STT</th>
              <th style="width: 9%;">Mã hàng hóa </th>
              <th style="width: 9%;">Nhóm lỗi </th>
              <th style="width: 9%;">Mã lỗi </th>
              <th style="width: 21%;">Tên lỗi </th>
              <th style="width: 9%;">Số lượng</th>
              <th style="width: 9%;">Ghi chú</th>
            </tr>
          </thead>
        </table>
      </div>
      <div id="table-errors" style="width: 99%;margin-bottom: 10px;">
        <table class="tables" style="margin-top: 0px;">
          <tbody>
            <tr *ngFor="let item of listOfError;let i = index;">
              <td style="width: 5%;"> {{i+1}}</td>
              <td style="text-align: left;width: 9%;">{{item.itemCode}}</td>
              <td style="text-align: left;width: 9%;"><span>{{item.errGroup}}</span></td>
              <td style="text-align: left;width: 9%;">{{item.errCode}}</td>
              <td style="text-align: left;width: 21%;"><span>{{item.errName}}</span></td>
              <td style="width: 9%;"><span>{{item.quantity}}</span></td>
              <td style="width: 9%;"><span>{{item.note}}</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</ng-template>